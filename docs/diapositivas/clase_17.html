<!DOCTYPE html>
<html lang="en"><head>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-contrib/bootstrap-icons-1.13.1/bootstrap-icons.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.7.32">

  <title>Inferencia Causal 2025 – clase_17</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-8b940f0b0c37e8b60983ca0a0adffd2d.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">


<section id="clase-17.-métodos-de-matching" class="title-slide slide level1 portada center">
<h1>Clase 17. Métodos de matching</h1>
<div style="text-align: center; font-size: 1.2em; font-weight: bold;">
<p>Inferencia Causal</p>
</div>
<div style="text-align: center; margin-top: 1em;">
<p><strong>Irvin Rojas</strong><br>
<br> <a href="https://rojasirvin.com" style="color: #ffffff;">rojasirvin.com</a></p>
</div>
<div style="text-align: center; margin-top: 1em;">
<p><a href="https://github.com/rojasirvin" target="_blank" style="margin-right: 0 10px;"> <i class="bi-github " style="" role="img" aria-hidden="true"></i> </a> <a href="https://twitter.com/RojasIrvin" target="_blank" style="margin-right: 0 10px;"> <i class="bi-twitter " style="" role="img" aria-hidden="true"></i> </a> <a href="https://scholar.google.com/citations?user=FUwdSTMAAAAJ&amp;hl=en" style="margin: 0 10px;"> <i class="bi-google " style="" role="img" aria-hidden="true"></i> </a></p>
</div>
<p><strong>Centro de Investigación y Docencia Económicas</strong> División de Economía</p>
<div class="cell">
<style type="text/css">
.huge .remark-code { /*Change made here*/
  font-size: 200% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 60% !important;
}
</style>
</div>
</section>

<section id="motivación" class="title-slide slide level1 center">
<h1>Motivación</h1>
<ul>
<li><p>Se considera la evaluación aleatoria como el <em>gold standard</em> de los métodos de evaluación</p></li>
<li><p>Bajo una aleatorización correcta de los tratamientos, las diferencias entre los grupos de tratamiento y control son atribuibles al tratamiento</p></li>
<li><p>Sin embargo, existen razones por las cuales es imposible llevar a cabo una asignación aleatoria</p></li>
<li><p>¿Nos conformamos con no poder decir nada?</p></li>
<li><p>Podemos usar métodos no experimentales que recaen sobre diversos supuestos para hacer inferencia sobre la efectividad del tratamiento</p></li>
</ul>
</section>

<section id="supuestos-de-identificación" class="title-slide slide level1 inverse center middle">
<h1>Supuestos de identificación</h1>

</section>

<section id="sesgo-de-selección" class="title-slide slide level1 center">
<h1>Sesgo de selección</h1>
<ul>
<li>Las razones que deteriminan la asignación del tratamiento determinen también el valor de <span class="math inline">\(Y\)</span></li>
</ul>
<p><span class="math display">\[
\begin{align}
E(Y(1)|D=1)&amp;-E(Y(0)|D=1)=\\
=&amp;TOT+E(Y(0)|D=1)-E(Y(0)|D=0)
\end{align}
\]</span></p>
<ul>
<li><p>La diferencia <span class="math inline">\(E(Y(0)|D=1)-E(Y(0)|D=0)\)</span> es el <strong>sesgo de selección</strong></p></li>
<li><p>Es decir, la diferencia en resultados entre tratados y no tratados nos da el <span class="math inline">\(TOT\)</span> solo si el sesgo de selección es cero</p></li>
<li><p>Una forma de eliminar el sesgo de selección es mediante la asignación aleatoria del tratamiento</p></li>
<li><p>Esto no siempre es posible por lo que recurrimos a supuestos para eliminar el sesgo de selección</p></li>
</ul>
</section>

<section id="métodos-de-apareamiento-o-matching" class="title-slide slide level1 center">
<h1>Métodos de apareamiento o <em>matching</em></h1>
<ul>
<li><p>Los métodos apareamiento o <em>matching</em> recaen en el <strong>supuesto de independencia condicional</strong></p></li>
<li><p>Al <em>controlar</em> por una serie de características <span class="math inline">\(X_i\)</span>, el tratamiento es <em>como</em> si fuera aleatorio</p></li>
<li><p>Podemos escribir</p></li>
</ul>
<p><span class="math display">\[
E(Y(1)|D=1,X)=E(Y(1)|D=0,X)
\]</span></p>
<p><span class="math display">\[
E(Y(0)|D=1,X)=E(Y(0)|D=0,X)
\]</span></p>
<ul>
<li>Esto es, los valores esperados de <span class="math inline">\(Y(1)\)</span> y <span class="math inline">\(Y(0)\)</span> son iguales cuando nos fijamos en cada valor de <span class="math inline">\(X\)</span></li>
</ul>
</section>

<section id="supuestos-de-identificación-del-tot" class="title-slide slide level1 center">
<h1>Supuestos de identificación del TOT</h1>
<p><strong>Supuesto 1. Inconfundibilidad</strong></p>
<p><span class="math display">\[
Y(0), Y(1) \perp  D|X
\]</span></p>
<ul>
<li><p>Dado un conjunto de variables <span class="math inline">\(X\)</span>, los resultados potenciales son independientes del tratamiento</p></li>
<li><p><span class="math inline">\(X\)</span> debe incluir todas las variables que determinan el tratamiento y los resultados potenciales</p></li>
</ul>
<p><strong>Supuesto 2: Traslape</strong></p>
<p><span class="math display">\[
0&lt; P(D=1|X) &lt; 1
\]</span></p>
<ul>
<li><p><span class="math inline">\(X\)</span> no predice <span class="math inline">\(D\)</span> perfectamente</p></li>
<li><p>Personas con el mismo <span class="math inline">\(X\)</span> tienen probabilidad positiva de ser tratados y no tratados</p></li>
</ul>
</section>

<section id="supuestos-de-identificación-del-tot-1" class="title-slide slide level1 center">
<h1>Supuestos de identificación del TOT</h1>
<ul>
<li><p>Cuando se cumple <strong>Supuesto 1</strong> <span class="math inline">\(+\)</span> <strong>Supuesto 2</strong> se conoce como <strong>ignorabilidad fuerte</strong></p></li>
<li><p>Heckman (1998) muestra que estás condiciones son demasiado estrictas</p></li>
<li><p>Para identificar el <span class="math inline">\(TOT\)</span> es suficiente:</p></li>
<li><p><strong>Supuesto 1a. Inconfundibilidad en el control</strong></p></li>
</ul>
<p><span class="math display">\[
Y(0) \perp  D | X
\]</span></p>
<ul>
<li><strong>Supuesto 2a. Traslape débil</strong></li>
</ul>
<p><span class="math display">\[
P(D=1|X) &lt; 1
\]</span></p>
</section>

<section id="matching-exacto" class="title-slide slide level1 inverse center middle">
<h1>Matching exacto</h1>

</section>

<section id="matching-exacto-1" class="title-slide slide level1 center">
<h1>Matching exacto</h1>
<ul>
<li><p>Un estimador de matching exacto consiste en <em>emparejar</em> individuos tratados y no tratados para cada valor específico de las <span class="math inline">\(X\)</span> y luego tomar el promedio ponderado de las diferencias</p></li>
<li><p>Tenemos datos observacionales de individuos que recibieron y no recibieron un tratamiento</p></li>
<li><p>Tenemos una serie de características discretizadas en <span class="math inline">\(X_i\)</span></p></li>
<li><p>Asumimos que controlando por las características <span class="math inline">\(X_i\)</span> podemos obtener diferencias causales</p></li>
<li><p>Luego hacemos un promedio de dichas diferencias</p></li>
</ul>
</section>

<section id="ejemplo-programa-hipotético-de-empleo" class="title-slide slide level1 center">
<h1>Ejemplo: programa hipotético de empleo</h1>
<ul>
<li>Usemos <a href="https://mixtape.scunning.com/matching-and-subclassification.html?panelset=r-code">el ejemplo</a> de MT (The Mixtape)</li>
</ul>
<div class="tiny">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a>read_data <span class="ot">&lt;-</span> <span class="cf">function</span>(df)</span>
<span id="cb1-2"><a></a>{</span>
<span id="cb1-3"><a></a>  full_path <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"https://raw.github.com/scunning1975/mixtape/master/"</span>, </span>
<span id="cb1-4"><a></a>                     df, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-5"><a></a>  df <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(full_path)</span>
<span id="cb1-6"><a></a>  <span class="fu">return</span>(df)</span>
<span id="cb1-7"><a></a>}</span>
<span id="cb1-8"><a></a></span>
<span id="cb1-9"><a></a>training_example <span class="ot">&lt;-</span> <span class="fu">read_data</span>(<span class="st">"training_example.dta"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>)</span>
<span id="cb1-11"><a></a></span>
<span id="cb1-12"><a></a>data.treat <span class="ot">&lt;-</span> training_example <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a></a>  <span class="fu">select</span>(unit_treat, age_treat, earnings_treat) <span class="sc">%&gt;%</span> </span>
<span id="cb1-14"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-15"><a></a>  <span class="fu">mutate</span>(<span class="at">earnings_treat=</span><span class="fu">as.numeric</span>(earnings_treat))</span>
<span id="cb1-16"><a></a></span>
<span id="cb1-17"><a></a>data.control <span class="ot">&lt;-</span> training_example <span class="sc">%&gt;%</span> </span>
<span id="cb1-18"><a></a>  <span class="fu">select</span>(unit_control, age_control, earnings_control)</span>
<span id="cb1-19"><a></a></span>
<span id="cb1-20"><a></a>data.matched <span class="ot">&lt;-</span> training_example <span class="sc">%&gt;%</span> </span>
<span id="cb1-21"><a></a>  <span class="fu">select</span>(unit_matched, age_matched, earnings_matched) <span class="sc">%&gt;%</span> </span>
<span id="cb1-22"><a></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>

<section id="ejemplo-programa-hipotético-de-empleo-1" class="title-slide slide level1 center">
<h1>Ejemplo: programa hipotético de empleo</h1>
<p>Supongamos que observamos los siguientes datos</p>
<div class="columns">
<div class="column tiny" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   unit_treat age_treat earnings_treat
        &lt;dbl&gt;     &lt;dbl&gt;          &lt;dbl&gt;
 1          1        18           9500
 2          2        29          12250
 3          3        24          11000
 4          4        27          11750
 5          5        33          13250
 6          6        22          10500
 7          7        19           9750
 8          8        20          10000
 9          9        21          10250
10         10        30          12500</code></pre>
</div>
</div>
</div><div class="column tiny" style="width:50%;">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
   unit_control age_control earnings_control
          &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;
 1            1          20             8500
 2            2          27            10075
 3            3          21             8725
 4            4          39            12775
 5            5          38            12550
 6            6          29            10525
 7            7          39            12775
 8            8          33            11425
 9            9          24             9400
10           10          30            10750
11           11          33            11425
12           12          36            12100
13           13          22             8950
14           14          18             8050
15           15          43            13675
16           16          39            12775
17           17          19             8275
18           18          30             9000
19           19          51            15475
20           20          48            14800</code></pre>
</div>
</div>
</div></div>
</section>

<section id="ejemplo-programa-hipotético-de-empleo-2" class="title-slide slide level1 center">
<h1>Ejemplo: programa hipotético de empleo</h1>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>Noten que si hiciéramos diferencias simples obtendríamos</li>
</ul>
<div class="tiny">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>earnings_treat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11075</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">mean</span>(data.control<span class="sc">$</span>earnings_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11101.25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="co">#Diferencia</span></span>
<span id="cb8-2"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>earnings_treat)<span class="sc">-</span> <span class="fu">mean</span>(data.control<span class="sc">$</span>earnings_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -26.25</code></pre>
</div>
</div>
</div>
<ul>
<li>Parece que en el grupo de control ganan más (efecto de tratamiento negativo)</li>
</ul>
</div><div class="column tiny" style="width:50%;">
<ul>
<li><p>El principal problema con esta diferencia es que sabemos que los ingresos crecen con la edad</p></li>
<li><p>Pero notemos que la muestra de no tratados tiene mayor edad promedio</p></li>
</ul>
<div class="tiny">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>age_treat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">mean</span>(data.control<span class="sc">$</span>age_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 31.95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="co">#Diferencia</span></span>
<span id="cb14-2"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>age_treat)<span class="sc">-</span> <span class="fu">mean</span>(data.control<span class="sc">$</span>age_control)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -7.65</code></pre>
</div>
</div>
</div>
<ul>
<li>Estaríamos <em>confundiendo</em> el efecto de la edad</li>
</ul>
</div></div>
</section>

<section id="ejemplo-programa-hipotético-de-empleo-3" class="title-slide slide level1 center">
<h1>Ejemplo: programa hipotético de empleo</h1>
<ul>
<li><p>Construyamos la muestra apareada</p></li>
<li><p>Para cada individuo en el grupo tratado, buscaremos uno en el de control que tenga la misma edad</p></li>
<li><p>Decimos que esa pareja hizo <em>match</em></p></li>
<li><p>Por ejemplo, la primera unidad tratada, con 18 años y un ingreso de 9,500 estaría emparejada con la unidad 14 del grupo de control, que tiene también 18 años y un ingreso de 9,500</p>
<ul>
<li>Para el individuo 18 construimos su ingreso contrafactual</li>
</ul></li>
<li><p>Cuando hay varias unidades en el grupo de control que pueden ser empatadas con la de tratamiento, podemos construir el ingreso contrafactual calculando el promedio</p>
<ul>
<li>Del grupo de control, los individuos 10 y 18 tienen 30 años, con ingresos 10,750 y 9,000, por lo que usamos el promedio (9875) para crear el contrafactual</li>
</ul></li>
</ul>
</section>

<section id="ejemplo-programa-hipotético-de-empleo-4" class="title-slide slide level1 center">
<h1>Ejemplo: programa hipotético de empleo</h1>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>La muestra apareada o contrafactual será</li>
</ul>
<div class="tiny">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   unit_matched age_matched earnings_matched
          &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;
 1            1          18             8050
 2            2          29            10525
 3            3          24             9400
 4            4          27            10075
 5            5          33            11425
 6            6          22             8950
 7            7          19             8275
 8            8          20             8500
 9            9          21             8725
10           10          30             9875</code></pre>
</div>
</div>
</div>
<ul>
<li>Noten que la edad es la misma entre los tratados y la muestra apareada</li>
</ul>
<div class="tiny">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>age_treat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a><span class="fu">mean</span>(data.matched<span class="sc">$</span>age_matched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.3</code></pre>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li>Decimos que la edad <em>está balanceada</em></li>
<li>Y entonces podemos calcular el efecto de tratamiento como la diferencia de ingresos entre los tratados y la muestra apareada</li>
</ul>
<div class="tiny">
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a><span class="co">#Diferencia</span></span>
<span id="cb21-2"><a></a><span class="fu">mean</span>(data.treat<span class="sc">$</span>earnings_treat)<span class="sc">-</span> <span class="fu">mean</span>(data.matched<span class="sc">$</span>earnings_matched)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1695</code></pre>
</div>
</div>
</div>
<ul>
<li>Hay un efecto positivo del programa de 1695 unidades monetarias</li>
</ul>
</div></div>
</section>

<section id="estimador-de-matching-exacto" class="title-slide slide level1 center">
<h1>Estimador de matching exacto</h1>
<ul>
<li>Lo anterior nos permite definir el <strong>estimador de matching exacto del TOT</strong></li>
</ul>
<p><span class="math display">\[\hat{\delta}_{TOT}=\frac{1}{N_T}\sum_{D_i=1}\left(Y_i-\left(\frac{1}{M}\sum_{m=1}^{M}Y_{jm(i)}\right)\right)\]</span></p>
</section>

<section id="importancia-del-soporte-común" class="title-slide slide level1 center">
<h1>Importancia del soporte común</h1>
<ul>
<li>Observemos lo que ocurre con la distribución de edades en ambos grupos</li>
</ul>
<div class="columns">
<div class="column" style="width:50%;">
<p>Tratados</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figures/unnamed-chunk-10-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>No tratados</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="figures/unnamed-chunk-11-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
<ul>
<li><p>El supuesto de traslape débil para identificar el TOT significa que para cada unidad tratada, hay al menos un no tratado</p></li>
<li><p>De otra forma, no podemos hacer la comparación</p></li>
</ul>
</section>

<section id="estimador-de-matching-exacto-1" class="title-slide slide level1 center">
<h1>Estimador de matching exacto</h1>
<ul>
<li><p>Hasta aquí, solo hemos imputado el contrafactual para cada unidad en el grupo tratado</p></li>
<li><p>Si podemos imputar también, para cada unidad no tratada, su correspondiente contrafactual tratado, podemos estimar el ATE</p></li>
<li><p>Y un <strong>estimador de matching exacto del ATE</strong> sería:</p></li>
</ul>
<p><span class="math display">\[\hat{\delta}_{ATE}=\frac{1}{N}\sum_{i}^N(2D_i-1)\left(Y_i-\left(\frac{1}{M}\sum_{m=1}^{M}Y_{jm(i)}\right)\right)\]</span></p>
</section>

<section id="ejemplo-de-la-vida-real" class="title-slide slide level1 center">
<h1>Ejemplo de la vida real</h1>
<ul>
<li><p>Tenemos varias características en <span class="math inline">\(X_i\)</span>, no solo la edad</p></li>
<li><p>Esto hace que cada valor <span class="math inline">\(X_i=x_i\)</span> este representado por una <em>celda</em></p></li>
<li><p><span class="math inline">\(X_i\)</span> incluye, por ejemplo, raza, año de solicitud de ingreso al programa, escolaridad, calificación en examen de aptitud, año de nacimiento (son las características del ejemplo que veremos más adelante)</p></li>
<li><p>Estas características definen <em>celdas</em> y dentro de cada celda tenemos tratados y no tratados</p></li>
</ul>
</section>

<section id="efecto-del-tratamiento-con-matching-exacto" class="title-slide slide level1 center">
<h1>Efecto del tratamiento con matching exacto</h1>
<ul>
<li>El TOT asumiendo inconfundibilidad:</li>
</ul>
<p><span class="math display">\[
\begin{aligned}
\delta^M=TOT&amp;=E\left\{ E(y_{1i}|X_i,D_i=1)-E(y_{0i}|X_i,D_i=0)|D_i=1\right\} \\
&amp;=E\left\{\delta_X | D_i=1\right\}
\end{aligned}
\]</span></p>
<ul>
<li><p><span class="math inline">\(\delta_X\)</span> es la diferencia de ingresos promedio entre estados de tratamiento para cada valor de <span class="math inline">\(X_i\)</span></p></li>
<li><p>Con <span class="math inline">\(X_i\)</span> discreta y con una muestra disponible:</p></li>
</ul>
<p><span class="math display">\[
\delta^M=\sum_{x} \delta_x P(X_i=x|D_i=1)
\]</span></p>
</section>

<section id="ejemplo-veteranos-de-guerra-en-estados-unidos" class="title-slide slide level1 center">
<h1>Ejemplo: veteranos de guerra en Estados Unidos</h1>
<ul>
<li><p><a href="https://www.jstor.org/stable/2998558">Angrist (1998)</a>, Estimating the Labor Market Impact of Voluntary Military Service Using Social Security Data on Military Applicants</p></li>
<li><p>El tratamiento es haber servido en el ejercito, algo que claramente tiene autoselección</p></li>
<li><p>Se trata de estimar el efecto en el ingreso</p></li>
<li><p>Los autores construyen celdas de acuerdo a las características antes mencionadas</p>
<ul>
<li>Raza, año de solicitud de ingreso al programa, escolaridad, calificación en examen de aptitud, año de nacimiento</li>
</ul></li>
</ul>
</section>

<section id="ejemplo-veteranos-de-guerra-en-estados-unidos-1" class="title-slide slide level1 center">
<h1>Ejemplo: veteranos de guerra en Estados Unidos</h1>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/ExactMatching_effects_table_a.jpg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/ExactMatching_effects_table_b.jpg" style="width:100.0%"></p>
<figcaption>Fuente: Angrist (1998)</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>

<section id="ejemplo-veteranos-de-guerra-en-estados-unidos-2" class="title-slide slide level1 center">
<h1>Ejemplo: veteranos de guerra en Estados Unidos</h1>
<ul>
<li><p>Noten que la columna (2) muestra lo que se hubiera concluido si solo se comparan diferencias de medias</p></li>
<li><p>Antes de 1980, las diferencias eran muy pequeñas (cero en términos prácticos)</p></li>
<li><p>En esta aplicación esta comparación llevaría a conclusiones incorrectas</p></li>
<li><p>Además, las diferencias para no-blancos y blancos son distintas</p></li>
<li><p>Hay un pico en los afectos alrededor de 1982</p></li>
<li><p>En esta aplicación, los resultados por <em>matching</em> y regresión son muy parecidos hasta 1984</p></li>
<li><p>La conclusión es que existe evidencia de efectos negativos en los ingresos por haber servido en el ejército en los blancos y efectos positivos para los individuos de otras razas</p></li>
</ul>
</section>

<section id="ejemplo-veteranos-de-guerra-en-estados-unidos-3" class="title-slide slide level1 center">
<h1>Ejemplo: veteranos de guerra en Estados Unidos</h1>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/ExactMatching_effects_graph_a.jpg" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="figures/ExactMatching_effects_graph_b.jpg" style="width:100.0%"></p>
<figcaption>Fuente: Angrist (1998)</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>

<section id="el-propensity-score" class="title-slide slide level1 inverse center middle">
<h1>El <em>propensity score</em></h1>

</section>

<section id="matching-exacto-es-impráctico" class="title-slide slide level1 center">
<h1>Matching exacto es impráctico</h1>
<ul>
<li><p>En la práctica es difícil manejar problemas en espacios de múltiples dimensiones: <strong>maldición de la dimensionalidad</strong></p></li>
<li><p>El problema de la maldición de la dimensionalidad se exacerba con el tamaño limitado de las bases de datos</p></li>
<li><p>Si <span class="math inline">\(X\)</span> tuviera solo indicadores binarios, el número de posibles combinaciones sería <span class="math inline">\(2^s\)</span></p></li>
<li><p>Por ejemplo, si solo tuviéramos <span class="math inline">\(X_1=\{\text{menor de 35 años}, \text{con 35 años o más}\}\)</span>, <span class="math inline">\(X_2=\{\text{más que preparatoria}, \text{menos que preparatoria}\}\)</span>, <span class="math inline">\(X_3=\{\text{indígena}, \text{no indígena}\}\)</span>, tendríamos que hacer ocho comparaciones:</p>
<ul>
<li>menor de 35 años, más que preparatoria, indígena</li>
<li>menor de 35 años, más que preparatoria, no indígena</li>
<li>…</li>
<li>con 35 años o más, menos que preparatoria, no indígena</li>
</ul></li>
<li><p>Pero Si <span class="math inline">\(X\)</span> incluye muchas variables, algunas tomando muchos valores, esto se vuelve imposible de realizar</p></li>
</ul>
</section>

<section id="maldición-de-la-dimensionalidad" class="title-slide slide level1 center">
<h1>Maldición de la dimensionalidad</h1>
<ul>
<li><p>El requerimiento de soporte común significa que debemos tener tratados y no tratados para cada valor de <span class="math inline">\(X_i\)</span> para hacer comparaciones</p></li>
<li><p>Cuando <span class="math inline">\(X_i\)</span> tiene muchas dimensiones, resulta un problema de <em>escasez</em> o <em>sparseness</em></p></li>
<li><p>Algunas celdas estarán vacías, o solo tendrán tratados, o solo tendrán no tratados</p></li>
</ul>
<div class="fragment">
<ul>
<li><p>Si tenemos unidades en todas las celdas de control, <strong>aún podemos estimar el TOT</strong></p>
<ul>
<li><p>Noten que cuando completamos la pase pareada en el ejemplo hipotético siempre encontramos a alguien en el grupo de control para asignárselo a un tratado</p></li>
<li><p>Pero al revés, no siempre es posible: por ejemplo, no hay ningún tratado de 48 años</p></li>
</ul></li>
</ul>
</div>
</section>

<section id="teorema-del-ps-rosenbaum-y-rubin-1983" class="title-slide slide level1 center">
<h1>Teorema del PS (Rosenbaum y Rubin, 1983)</h1>
<ul>
<li><p><strong>Corolario 1. Inconfundibilidad dado el propensity score</strong></p></li>
<li><p>El <strong>Supuesto 1</strong> implica:</p></li>
</ul>
<p><span class="math display">\[
Y(0), Y(1) \perp  D|P(X)
\]</span></p>
<p>donde <span class="math inline">\(P(X)=P(D=1|X)\)</span> es la probabilidad de ser tratado dado un conjunto de covariables <span class="math inline">\(X\)</span>, el <em>propensity score</em> o PS</p>
</section>

<section id="estimación" class="title-slide slide level1 center">
<h1>Estimación</h1>
<ul>
<li>Podemos estimar el efecto del tratamiento:</li>
</ul>
<p><span class="math display">\[
TOT^{PSM}=E_{P(X)|D=1} \left(E(Y(1)|D=1, P(X))-E(Y(0)|D=0,P(X)) \right)
\]</span></p>
<ul>
<li>El <span class="math inline">\(TOT\)</span> es la diferencia en la variable de resultados de los tratados y los no tratados pesada por la distribución del PS en los tratados</li>
</ul>
</section>

<section id="estimación-1" class="title-slide slide level1 center">
<h1>Estimación</h1>
<ul>
<li><p>Debemos por tanto primero calcular el PS</p></li>
<li><p>Se empatan o se hace match de unidades que fueron tratadas con unidades que no lo fueron usando el PS</p></li>
<li><p>Se mide la diferencia en la variable de resultados entre estos grupos</p></li>
<li><p>Se hace un promedio ponderado de las diferencias</p></li>
</ul>
</section>

<section id="implementación" class="title-slide slide level1 center">
<h1>Implementación</h1>
<ol type="1">
<li><p>Estimación del PS</p></li>
<li><p>Escoger el algoritmo de matching</p></li>
<li><p>Comprobar la calidad del matching</p></li>
<li><p>Estimar el <span class="math inline">\(TOT\)</span></p></li>
</ol>
</section>

<section id="especificar-el-modelo-del-ps" class="title-slide slide level1 center">
<h1>Especificar el modelo del PS</h1>
<ul>
<li><p>Se usa un modelo <em>probit</em> o <em>logit</em></p>
<ul>
<li><p><strong>Prueba y error</strong>. Maximizar la tasa clasificación de tratamientos y controles usando <span class="math inline">\(\bar{P}\)</span>, la proporción de tratamientos en la muestra</p></li>
<li><p><strong>Significancia estadística</strong>. Usar solo las variables estadísticamente significativas, comenzando con un modelo muy básico</p></li>
<li><p><strong>Validación cruzada</strong>. Comenzar con un modelo simple y agregar grupos de variables comparando las que reduzcan el error cuadrático promedio</p></li>
</ul></li>
<li><p>El propósito del PS es sobre todo generar balance de las variables en <span class="math inline">\(X\)</span></p></li>
</ul>
</section>

<section id="recomendaciones-prácticas" class="title-slide slide level1 center">
<h1>Recomendaciones prácticas</h1>
<ul>
<li><p>Las características <span class="math inline">\(X\)</span> que determinan la probabilidad de tratamiento deben ser observables</p></li>
<li><p>Las variables usadas para calcular el PS no deben haber sido afectadas por el tratamiento</p></li>
<li><p>Idealmente usamos variables <span class="math inline">\(X\)</span> pre-intervención</p></li>
<li><p>Cuando no hay <span class="math inline">\(X\)</span> pre-intervención, a veces se puede obtener el PS con variables post-intervención siempre y cuando estas no hayan sido afectadas por el tratamiento (pocas veces recomendado)</p></li>
</ul>
<div class="fragment">
<ul>
<li><p>Extremadamente recomendable</p>
<ul>
<li>Caliendo, M., &amp; Kopeinig, S. (2008). Some practical guidance for the implementation of propensity score matching. <em>Journal of economic surveys</em>, 22(1), 31-72.</li>
</ul></li>
</ul>
</div>
</section>

<section id="próxima-sesión" class="title-slide slide level1 center">
<h1>Próxima sesión</h1>
<ul>
<li><p>Veremos un ejemplo del PSM</p></li>
<li><p>Becerril, J., &amp; Abdulai, A. (2010). The impact of improved maize varieties on poverty in Mexico: a propensity score-matching approach. <em>World development</em>, 38(7), 1024-1035.</p></li>
<li><p>Veremos cómo estimar el PSM en R usando distintos algoritmos de matching</p></li>
</ul>
</section>

<section id="section" class="title-slide slide level1 inverse center middle">
<h1></h1>
<p>Presentación creada usando el paquete <a href="https://github.com/yihui/xaringan"><strong>xaringan</strong></a> en R.</p>
<p>El <em>chakra</em> viene de <a href="https://remarkjs.com">remark.js</a>, <a href="http://yihui.org/knitr"><strong>knitr</strong></a>, y <a href="https://rmarkdown.rstudio.com">R Markdown</a>.</p>
<p>Material de clase en versión preliminar.</p>
<p><strong>No reproducir, no distribuir, no citar.</strong></p>


</section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="https://d1yjjnpx0p53s8.cloudfront.net/styles/logo-thumbnail/s3/122010/logo_cide_verde.png?itok=NUstTkpt" class="slide-logo"></p>
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1600,

        height: 900,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    

    <script>

      // htmlwidgets need to know to resize themselves when slides are shown/hidden.

      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current

      // slide changes (different for each slide format).

      (function () {

        // dispatch for htmlwidgets

        function fireSlideEnter() {

          const event = window.document.createEvent("Event");

          event.initEvent("slideenter", true, true);

          window.document.dispatchEvent(event);

        }

    

        function fireSlideChanged(previousSlide, currentSlide) {

          fireSlideEnter();

    

          // dispatch for shiny

          if (window.jQuery) {

            if (previousSlide) {

              window.jQuery(previousSlide).trigger("hidden");

            }

            if (currentSlide) {

              window.jQuery(currentSlide).trigger("shown");

            }

          }

        }

    

        // hookup for slidy

        if (window.w3c_slidy) {

          window.w3c_slidy.add_observer(function (slide_num) {

            // slide_num starts at position 1

            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);

          });

        }

    

      })();

    </script>

    

    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
            const codeEl = trigger.previousElementSibling.cloneNode(true);
            for (const childEl of codeEl.children) {
              if (isCodeAnnotation(childEl)) {
                childEl.remove();
              }
            }
            return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp('/' + window.location.host + '/');
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>